#include <gb/gb.h>
#include <gb/font.h>
#include <rand.h>
#include <stdio.h>

#define spritesize 8

// typedef char          	INT8;
// typedef unsigned char 	UINT8;
// typedef int           	INT16;
// typedef unsigned int  	UINT16;
// typedef long          	INT32;
// typedef unsigned long 	UINT32;

// typedef int	      	size_t;
// typedef UINT16		clock_t;

unsigned char mymaptile[] =
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,
  0x00,0x04,0x00,0x04,0x00,0x04,0x00,0x04,
  0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,
  0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x07,0x00,0x04,0x00,0x04,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0xE0,0x00,0x20,0x00,0x20,
  0x00,0x20,0x00,0x20,0x00,0xE0,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x04,0x00,0x04,0x00,0x07,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

unsigned char mymap[] =
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0x04,
  0x04,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,
  0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,
  0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x02,
  0x02,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

unsigned char ShipSprite[] =
{
  0x01,0x00,0x01,0x01,0x01,0x01,0x81,0x01,
  0x81,0x81,0x81,0x82,0x03,0xE4,0x67,0x99,
  0x80,0x00,0x80,0x80,0x80,0x80,0x81,0x80,
  0x81,0x81,0x81,0x41,0xC0,0x27,0xE6,0x99,
  0x7F,0x81,0x3F,0x41,0x0F,0x30,0x01,0x0E,
  0x08,0x01,0x1C,0x00,0x2A,0x00,0x00,0x00,
  0xFE,0x81,0xFC,0x82,0xF0,0x0C,0x80,0x70,
  0x10,0x80,0x38,0x00,0x54,0x00,0x00,0x00,
  0x38,0xF0,0x80,0x40,0x80,0x40,0x00,0x80,
  0x00,0x80,0x80,0x40,0xC0,0x20,0xFF,0x9E,
  0xFF,0x9E,0xC0,0x20,0x80,0x40,0x00,0x80,
  0x00,0x80,0x80,0x40,0x80,0x40,0x38,0xF0,
  0x00,0x01,0x01,0x02,0x43,0x04,0x23,0x04,
  0x77,0x08,0x27,0x08,0x47,0x08,0x0F,0x13,
  0x0F,0x13,0x47,0x08,0x27,0x08,0x77,0x08,
  0x23,0x04,0x43,0x04,0x01,0x02,0x00,0x01,
  0xE6,0x99,0xC0,0x27,0x81,0x41,0x81,0x81,
  0x81,0x80,0x80,0x80,0x80,0x80,0x80,0x00,
  0x67,0x99,0x03,0xE4,0x81,0x82,0x81,0x81,
  0x81,0x01,0x01,0x01,0x01,0x01,0x01,0x00,
  0x00,0x00,0x54,0x00,0x38,0x00,0x10,0x80,
  0x80,0x70,0xF0,0x0C,0xFC,0x82,0xFE,0x81,
  0x00,0x00,0x2A,0x00,0x1C,0x00,0x08,0x01,
  0x01,0x0E,0x0F,0x30,0x3F,0x41,0x7F,0x81,
  0xFF,0x79,0x03,0x04,0x01,0x02,0x00,0x01,
  0x00,0x01,0x01,0x02,0x01,0x02,0x1C,0x0F,
  0x1C,0x0F,0x01,0x02,0x01,0x02,0x00,0x01,
  0x00,0x01,0x01,0x02,0x03,0x04,0xFF,0x79,
  0xF0,0xC8,0xE2,0x10,0xE4,0x10,0xEE,0x10,
  0xC4,0x20,0xC2,0x20,0x80,0x40,0x00,0x80,
  0x00,0x80,0x80,0x40,0xC2,0x20,0xC4,0x20,
  0xEE,0x10,0xE4,0x10,0xE2,0x10,0xF0,0xC8
};

unsigned char ShieldSprite[] =
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,
  0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
  0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
  0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,
  0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0
};

unsigned char ArrowSprite[] =
{
  0xE0,0xE0,0xE0,0xE0,0xFC,0xFC,0xF8,0xF8,
  0xF0,0xF0,0xE0,0xE0,0xC0,0xC0,0x80,0x80,
  0x07,0x07,0x07,0x07,0x3F,0x3F,0x1F,0x1F,
  0x0F,0x0F,0x07,0x07,0x03,0x03,0x01,0x01,
  0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
  0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
  0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
  0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
  0xFF,0xFF,0x7F,0x7F,0x3F,0x3F,0x1C,0x1C,
  0x0C,0x0C,0x04,0x04,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x04,0x04,0x0C,0x0C,
  0x1C,0x1C,0x3F,0x3F,0x7F,0x7F,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  0x01,0x01,0x03,0x03,0x07,0x07,0x0F,0x0F,
  0x1F,0x1F,0x3F,0x3F,0x07,0x07,0x07,0x07,
  0x80,0x80,0xC0,0xC0,0xE0,0xE0,0xF0,0xF0,
  0xF8,0xF8,0xFC,0xFC,0xE0,0xE0,0xE0,0xE0,
  0x00,0x00,0x00,0x00,0x20,0x20,0x30,0x30,
  0x38,0x38,0xFC,0xFC,0xFE,0xFE,0xFF,0xFF,
  0xFF,0xFF,0xFE,0xFE,0xFC,0xFC,0x38,0x38,
  0x30,0x30,0x20,0x20,0x00,0x00,0x00,0x00
};

unsigned char Num[] =
{
  0x7C,0x7C,0xC6,0xC6,0xC6,0xC6,0x00,0x00,
  0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
  0x06,0x06,0x06,0x06,0x06,0x06,0x00,0x00,
  0x06,0x06,0x06,0x06,0x06,0x06,0x00,0x00,
  0x7C,0x7C,0x06,0x06,0x06,0x06,0x7C,0x7C,
  0xC0,0xC0,0xC0,0xC0,0x7C,0x7C,0x00,0x00,
  0x7C,0x7C,0x06,0x06,0x06,0x06,0x7C,0x7C,
  0x06,0x06,0x06,0x06,0x7C,0x7C,0x00,0x00,
  0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,
  0x06,0x06,0x06,0x06,0x06,0x06,0x00,0x00,
  0x7C,0x7C,0xC0,0xC0,0xC0,0xC0,0x7C,0x7C,
  0x06,0x06,0x06,0x06,0x7C,0x7C,0x00,0x00,
  0x7C,0x7C,0xC0,0xC0,0xC0,0xC0,0x7C,0x7C,
  0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
  0x7C,0x7C,0x06,0x06,0x06,0x06,0x00,0x00,
  0x06,0x06,0x06,0x06,0x06,0x06,0x00,0x00,
  0x7C,0x7C,0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,
  0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,0x00,0x00,
  0x7C,0x7C,0xC6,0xC6,0xC6,0xC6,0x7C,0x7C,
  0x06,0x06,0x06,0x06,0x7C,0x7C,0x00,0x00
};

unsigned char GV[] =
{
  0x3C,0x3C,0x62,0x62,0x60,0x60,0x6E,0x6E,
  0x66,0x66,0x66,0x66,0x3E,0x3E,0x00,0x00,
  0x3C,0x3C,0x66,0x66,0x66,0x66,0x7E,0x7E,
  0x66,0x66,0x66,0x66,0x66,0x66,0x00,0x00,
  0xFC,0xFC,0xD6,0xD6,0xD6,0xD6,0xD6,0xD6,
  0xD6,0xD6,0xC6,0xC6,0xC6,0xC6,0x00,0x00,
  0x7E,0x7E,0x60,0x60,0x60,0x60,0x7C,0x7C,
  0x60,0x60,0x60,0x60,0x7E,0x7E,0x00,0x00,
  0x3C,0x3C,0x66,0x66,0x66,0x66,0x66,0x66,
  0x66,0x66,0x66,0x66,0x3C,0x3C,0x00,0x00,
  0x66,0x66,0x66,0x66,0x66,0x66,0x66,0x66,
  0x66,0x66,0x64,0x64,0x78,0x78,0x00,0x00,
  0x7C,0x7C,0x66,0x66,0x66,0x66,0x7C,0x7C,
  0x66,0x66,0x66,0x66,0x66,0x66,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

typedef struct GameCharacter {
    UBYTE spritids[4]; // all characters use 4 sprites
    UINT8 x;
    UINT8 y;
    UINT8 width;
    UINT8 height;
}GC;

typedef struct ArrowCharacter {
    UBYTE spritids[4]; // all characters use 4 sprites
    UINT8 x;
    UINT8 y;
    UINT8 width;
    UINT8 height;
    UINT8 pos;
}AC;

typedef struct ShieldCharacter {
    UBYTE spritids[2];
    UINT8 x[2];
    UINT8 y[2];
    UINT8 width;
    UINT8 height;
}SC;

GC ship;
AC arrow;
UINT8 speed = 1;
UWORD score = 0;
SC shield;

void movegamecharacter(GC *character, UINT8 x, UINT8 y){
    move_sprite(character->spritids[0], x, y);
    move_sprite(character->spritids[1], x + spritesize, y);
    move_sprite(character->spritids[2], x, y + spritesize);
    move_sprite(character->spritids[3], x + spritesize, y + spritesize);
}

void movearrowcharacter(AC *character, UINT8 x, UINT8 y){
    move_sprite(character->spritids[0], x, y);
    move_sprite(character->spritids[1], x + spritesize, y);
    move_sprite(character->spritids[2], x, y + spritesize);
    move_sprite(character->spritids[3], x + spritesize, y + spritesize);
}

void moveshield(SC *shield){
    move_sprite(shield->spritids[0],shield->x[0],shield->y[0]);
    move_sprite(shield->spritids[1],shield->x[1],shield->y[1]);
}

void setupship(){
    ship.x = 80;
    ship.y = 80;
    ship.width = 16;
    ship.height = 16;

    // load sprites for ship
    set_sprite_tile(0, 0);
    ship.spritids[0] = 0;
    set_sprite_tile(1, 1);
    ship.spritids[1] = 1;
    set_sprite_tile(2, 2);
    ship.spritids[2] = 2;
    set_sprite_tile(3, 3);
    ship.spritids[3] = 3;

    movegamecharacter(&ship, ship.x, ship.y);
}

void setupshield(){
    shield.x[0] = 80;
    shield.x[1] = 88;
    shield.y[0] = 68;
    shield.y[1] = 68;

    set_sprite_tile(4,28);
    shield.spritids[0] = 4;
    set_sprite_tile(5,28);
    shield.spritids[1] = 5;

    moveshield(&shield);
}

void rotatesprite(UINT8 pos){
    if(pos == 0){
        set_sprite_tile(0,0);
        set_sprite_tile(1,1);
        set_sprite_tile(2,2);
        set_sprite_tile(3,3);

        shield.x[0] = 80;
        shield.x[1] = 88;
        shield.y[0] = 68;
        shield.y[1] = 68;

        shield.height = 3;
        shield.width = 16;

        set_sprite_tile(4,28);
        set_sprite_tile(5,28);

        moveshield(&shield);
    }
    else if(pos == 1){
        set_sprite_tile(0,6);
        set_sprite_tile(1,4);
        set_sprite_tile(2,7);
        set_sprite_tile(3,5);

        shield.x[0] = 100;
        shield.x[1] = 100;
        shield.y[0] = 80;
        shield.y[1] = 88;

        shield.height = 16;
        shield.width = 3;

        set_sprite_tile(4,31);
        set_sprite_tile(5,31);

        moveshield(&shield);
    }
    else if(pos == 2){
        set_sprite_tile(0,11);
        set_sprite_tile(1,10);
        set_sprite_tile(2,9);
        set_sprite_tile(3,8);

        shield.x[0] = 80;
        shield.x[1] = 88;
        shield.y[0] = 100;
        shield.y[1] = 100;

        shield.height = 3;
        shield.width = 16;

        set_sprite_tile(4,30);
        set_sprite_tile(5,30);

        moveshield(&shield);
    }
    else if(pos == 3){
        set_sprite_tile(0,13);
        set_sprite_tile(1,15);
        set_sprite_tile(2,12);
        set_sprite_tile(3,14);

        shield.x[0] = 68;
        shield.x[1] = 68;
        shield.y[0] = 80;
        shield.y[1] = 88;

        shield.height = 16;
        shield.width = 3;

        set_sprite_tile(4,29);
        set_sprite_tile(5,29);

        moveshield(&shield);
    }
}

void rotatearrow(AC *arrow,UINT8 pos){
    if(pos == 0){
        set_sprite_tile(arrow->spritids[0],19);
        set_sprite_tile(arrow->spritids[1],18);
        set_sprite_tile(arrow->spritids[2],17);
        set_sprite_tile(arrow->spritids[3],16);
    }
    else if(pos == 1){
        set_sprite_tile(arrow->spritids[0],21);
        set_sprite_tile(arrow->spritids[1],23);
        set_sprite_tile(arrow->spritids[2],20);
        set_sprite_tile(arrow->spritids[3],22);
    }
    else if(pos == 2){
        set_sprite_tile(arrow->spritids[0],24);
        set_sprite_tile(arrow->spritids[1],25);
        set_sprite_tile(arrow->spritids[2],19);
        set_sprite_tile(arrow->spritids[3],18);
    }
    else if(pos == 3){
        set_sprite_tile(arrow->spritids[0],23);
        set_sprite_tile(arrow->spritids[1],26);
        set_sprite_tile(arrow->spritids[2],22);
        set_sprite_tile(arrow->spritids[3],27);
    }
}

void setuparrow(){
    arrow.pos = (UINT8)rand() % 4;
    if(arrow.pos == 0){
        arrow.x = 80;
        arrow.y = 0;
    }
    else if(arrow.pos == 1){
        arrow.x = 176;
        arrow.y = 80;
    }
    else if(arrow.pos == 2){
        arrow.x = 80;
        arrow.y = 144;
    }
    else if(arrow.pos == 3){
        arrow.x = 248;
        arrow.y = 80;
    }
    arrow.width = 16;
    arrow.height = 16;

    // load sprites for ship
    set_sprite_tile(6, 19);
    arrow.spritids[0] = 6;
    set_sprite_tile(7, 18);
    arrow.spritids[1] = 7;
    set_sprite_tile(8, 17);
    arrow.spritids[2] = 8;
    set_sprite_tile(9, 16);
    arrow.spritids[3] = 9;

    movearrowcharacter(&arrow, arrow.x, arrow.y);
    rotatearrow(&arrow,arrow.pos);
}

void printscore(){
    if(score < 10){
        set_sprite_tile(98,score+32);
        move_sprite(98,160,16);
    }
    else if(score < 100){
        UINT8 ten = score / 10;
        UINT8 one = score % 10;
        set_sprite_tile(98,one+32);
        move_sprite(98,160,16);
        set_sprite_tile(99,ten+32);
        move_sprite(99,152,16);
    }
    else{
        UINT8 hun = score / 100;
        UINT8 ten = (score % 10) / 10;
        UINT8 one = score % 100;
        set_sprite_tile(98,one+32);
        move_sprite(98,160,16);
        set_sprite_tile(99,ten+32);
        move_sprite(99,152,16);
        set_sprite_tile(100,hun+32);
        move_sprite(100,144,16);
    }
}

void printGV(){
    set_sprite_tile(90,42);
    move_sprite(90,48,40);
    set_sprite_tile(91,43);
    move_sprite(91,56,40);
    set_sprite_tile(92,44);
    move_sprite(92,64,40);
    set_sprite_tile(93,45);
    move_sprite(93,72,40);
    set_sprite_tile(94,46);
    move_sprite(94,96,40);
    set_sprite_tile(95,47);
    move_sprite(95,104,40);
    set_sprite_tile(96,45);
    move_sprite(96,112,40);
    set_sprite_tile(97,48);
    move_sprite(97,120,40);
}

void performantdelay(UINT8 numloops){
    UINT8 i;
    for(i = 0; i < numloops; i++){
        wait_vbl_done();
    }
}

void fadeout(){
    UINT8 i;
	for(i=0;i<4;i++){
		switch(i){
			case 0:
				BGP_REG = 0xE4;
				break;
			case 1:
				BGP_REG = 0xF9;
				break;
			case 2:
				BGP_REG = 0xFE;
				break;
			case 3:
				BGP_REG = 0xFF;	
				break;						
		}
		performantdelay(10);
	}
}

void fadein(){
    UINT8 i;
	for(i=0;i<3;i++){
		switch(i){
			case 0:
				BGP_REG = 0xFE;
				break;
			case 1:
				BGP_REG = 0xF9;
				break;
			case 2:
				BGP_REG = 0xE4;
				break;					
		}
		performantdelay(10);
	}
}

UBYTE checkcollisions(GC *ship, AC* arrow){
    return (ship->x >= arrow->x && ship->x <= arrow->x + arrow->width) && (ship->y >= arrow->y && ship->y <= arrow->y + arrow->height) ||
           (arrow->x >= ship->x && arrow->x <= ship->x + ship->width) && (arrow->y >= ship->y && arrow->y <= ship->y + ship->height);
}

UBYTE checkcollisions2(SC *shield, AC* arrow){
    return (shield->x[0] >= arrow->x && shield->x[0] <= arrow->x + arrow->width) && (shield->y[0] >= arrow->y && shield->y[0] <= arrow->y + arrow->height) ||
           (arrow->x >= shield->x[0] && arrow->x <= shield->x[0] + shield->width) && (arrow->y >= shield->y[0] && arrow->y <= shield->y[0] + shield->height);
}

void main(){
    UWORD seed;
    printf("PRESS SELECT \n");
    waitpad(J_SELECT);
    waitpadup();
    seed = DIV_REG;
    printf("PRESS START \n");
    waitpad(J_START);
    waitpadup();
    seed |= (UWORD)DIV_REG << 8;
    initarand(seed);

    DISPLAY_ON;
    SHOW_BKG;
    SHOW_SPRITES;
    
    fadeout();

    set_sprite_data(0,16,ShipSprite);
    set_sprite_data(16,12,ArrowSprite);
    set_sprite_data(28,4,ShieldSprite);
    set_sprite_data(32,10,Num);
    set_sprite_data(42,7,GV);
    setupship();
    setuparrow();
    setupshield();

    set_bkg_data(0,9,mymaptile);
    set_bkg_tiles(0,0,20,18,mymap);

    fadein();

    while(!checkcollisions(&ship,&arrow)){
        printscore();
        switch(joypad()){
            case J_LEFT:
                rotatesprite(3);
                break;
            case J_RIGHT:
                rotatesprite(1);
                break;
            case J_UP:
                rotatesprite(0);
                break;
            case J_DOWN:
                rotatesprite(2);
                break;
            default:
                break;
        }
        performantdelay(2);
        
        if(arrow.pos == 0){
            arrow.y += speed;
        }
        else if(arrow.pos == 1){
            arrow.x -= speed;
        }
        else if(arrow.pos == 2){
            arrow.y -= speed;
        }
        else if(arrow.pos == 3){
            arrow.x += speed;
        }
        movearrowcharacter(&arrow,arrow.x,arrow.y);
        if(checkcollisions2(&shield,&arrow)){
            speed += 1;
            score += 1;
            setuparrow();
        }
    }
    printGV();
}
